{% extends "_base.html" %}
{% block content %}

<script language="javascript" type="text/javascript">
    function edit_field(id){
        var elem = $('#question_' + id + ' a');
        var time_elem = $('#time_'+id);
        if (elem.hasClass('activated')){
            return;
        }
        var text = elem.text();
        var time = time_elem.text();
        elem.addClass('activated');
        elem.text('');
        elem.hide();
        time_elem.text('');
        var edit_field = $('<input type="text" size="50"/>').val(text);
        var time_field = $('<input type="text" size="3"/>').val(time);

        var editelem = $('#sedit_'+id);
        editelem.click(function(){
            $('#edit_'+id).show();
            $('#sedit_'+id).hide();
            
            var newTime = time_field.val();
            edit_question(id,edit_field.val(),newTime);

            var newText = elem.val();
            elem.text(newText);
            elem.removeClass('activated');

            time_elem.text(newTime);
            
            $(time_field).remove();
            $(edit_field).remove();
            $('#sedit_'+id).unbind('click');
        });
        $('#sedit_'+id).show();
        $('#edit_'+id).hide();
        
        edit_field.appendTo(elem.parent()).focus();
        time_field.appendTo(time_elem);
    }

  function edit_question(id,text,time){
    $.getJSON("/edit_question",{id:id,text:text,time:time},
    function(data){
      if(data.check){
        if(!data.available){
          temp="False"
        }
        else{
          temp="True"
        }
        $('#available_'+id).html(temp);
        $('#question_'+id).html('<a href=\"/filteranswer/'+data.text+'\">'+data.text+'</a>');
        $('#time_'+id).html(data.time)
      }
      else{
        $('#error').html("Error while editing question question.");
      }
    });
  }

    function delete_question(id){
        $.getJSON("/delete_question/"+id,{},
            function(data){
                if (data.deleted)
                    $('#row_'+id).remove();
                else
                    $('#error').html("Error while deleting question.");
            });
    }

  function toggle_question(id){
    $.getJSON("/toggle_question",{id:id},
    function(data){
      if(data.check){
        if(!data.toggle){
          temp="False"
        }
        else{
          temp="True"
        }
        $('#available_'+id).html(temp);
      }
      else{
        $('#error').html("Error while togging question question.");
      }
    });
  }

    function add_question(){
        $('#addQ').hide()
            $('#qList tr:last').after(
                    '<tr><th colspan="6"> \
                    <form action="/handle_question" method="post" style="display:block"> \
                        <input type="textbox" name="question"> \
                        <input type="number" name="time" size="3" maxlength="3"> \
                        <input type="checkbox" name="active"> \
                        <input type="submit" value="Submit">\
                    </form> \
                </th></tr>');
    }

</script>

<div id="error" style="background-color: #a33; color: white;"></div>
<table id="qList" class="table table-hover table-bordered table-striped">
    <thead>
    <tr>
        <!--<th>id</th>-->
        <th>Question</th>
        <th>Active</th>
        <th>Time</th>
        <th>Activate</th>
        <th>Edit</th>
        <th>Delete</th>
    </tr>
    </thead>
    {% for question in questions %}
        <tr id="row_{{question.id}}">
            <td id="question_{{question.id}}">
                <a href="/filteranswers/{{question.id}}" class="blue">{{question.question}}</a>
            </td>
            <td id="available_{{question.id}}">{{question.available}}</td>
            <td id="time_{{question.id}}">{{question.time}}</td>
            <td>
				<a id="edit_{{question.id}}" onclick=edit_field({{question.id}}) /><i class="icon-pencil"></i> edit</a>
				<a id="sedit_{{question.id}}" style="display:none"><i class=" icon-ok-sign"></i> submit</a>
			</td>
            <td><a onclick=toggle_question({{question.id}}) /><i class="icon-retweet"></i> toggle</a></td>
            <td><a onclick=delete_question({{question.id}})  /><i class="icon-remove-sign"></i> delete</a></td>
        </tr>
    {% endfor %}
</table>
<button id="addQ" value="add" class="btn-primary btn" onclick=add_question() />Add Question</button>
{% endblock %}
